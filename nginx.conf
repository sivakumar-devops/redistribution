#server {
#listen 80;
#server_name example.com;
#return 301 https://example.com$request_uri;
#}

server {
    listen       80 default_server;
    listen       [::]:80 default_server;

    # Optional HTTPS setup
    # listen 443 ssl;
    # ssl_certificate /path/to/certificate/file/domain.crt;
    # ssl_certificate_key /path/to/key/file/domain.key;

    # General proxy settings
    proxy_buffer_size   128k;
    proxy_buffers       4 256k;
    proxy_busy_buffers_size 256k;
    large_client_header_buffers 4 16k;
    proxy_read_timeout  300;
    proxy_connect_timeout 300;
    proxy_send_timeout  300;
    send_timeout        300;
    client_max_body_size 200M;

    # WordPress site configuration
    location /wordpress/ {
        root /var/www/wordpress;
        try_files $uri $uri/ /index.php?$args;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location = /favicon.ico { log_not_found off; access_log off; }
    location = /robots.txt { log_not_found off; access_log off; allow all; }
    location ~* \.(css|gif|ico|jpeg|jpg|js|png)$ {
        expires max;
        log_not_found off;
    }

    location ~ /\.ht {
        deny all;
    }

    # Bold BI site configuration
    location /dashboard/ { 
        proxy_pass         http://localhost:6500/dashboard/; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    }

    location /dashboard/api { 
        proxy_pass         http://localhost:6501/dashboard/api; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    } 

    location /dashboard/ums { 
        proxy_pass         http://localhost:6502/dashboard/ums; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    } 

    location /dashboard/bi { 
        proxy_pass         http://localhost:6504/dashboard/bi; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    } 

    location /dashboard/bi/api { 
        proxy_pass         http://localhost:6505/dashboard/bi/api; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    } 

    location /dashboard/bi/jobs { 
        proxy_pass         http://localhost:6506/dashboard/bi/jobs; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    } 

    location /dashboard/bi/designer { 
        proxy_pass         http://localhost:6507/dashboard/bi/designer; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection keep-alive; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    } 

    location /dashboard/bi/designer/helper { 
        proxy_pass http://localhost:6507/dashboard/bi/designer/helper; 
        proxy_http_version 1.1; 
        proxy_set_header   Upgrade $http_upgrade; 
        proxy_set_header   Connection "upgrade"; 
        proxy_set_header   Host $host; 
        proxy_cache_bypass $http_upgrade; 
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; 
        proxy_set_header   X-Forwarded-Proto $scheme; 
    }
}

